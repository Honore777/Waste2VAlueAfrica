{% extends "base.html" %}
{% block title %}Edit Profile | Waste2Value Africa{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto mt-8 bg-white p-8 rounded-xl shadow-lg">

    <h1 class="text-3xl font-bold mb-6 text-gray-800">Edit Profile</h1>

    <!-- Profile Details Form -->
    <form method="POST" class="space-y-4">
        {{ form.hidden_tag() }}

        <div>
            {{ form.full_name.label(class="block font-semibold text-gray-700 mb-1") }}
            {{ form.full_name(class="w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500") }}
            {% for error in form.full_name.errors %}
                <span class="text-red-500 text-sm">{{ error }}</span>
            {% endfor %}
        </div>

        <div>
            {{ form.bio.label(class="block font-semibold text-gray-700 mb-1") }}
            {{ form.bio(class="w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500") }}
            {% for error in form.bio.errors %}
                <span class="text-red-500 text-sm">{{ error }}</span>
            {% endfor %}
        </div>

        <div>
            {{ form.location.label(class="block font-semibold text-gray-700 mb-1") }}
            {{ form.location(class="w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500") }}
            {% for error in form.location.errors %}
                <span class="text-red-500 text-sm">{{ error }}</span>
            {% endfor %}
        </div>

        <!-- Social Media Fields -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                {{ form.twitter.label(class="block font-semibold text-gray-700 mb-1") }}
                {{ form.twitter(class="w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500") }}
                {% for error in form.twitter.errors %}
                    <span class="text-red-500 text-sm">{{ error }}</span>
                {% endfor %}
            </div>
            <div>
                {{ form.instagram.label(class="block font-semibold text-gray-700 mb-1") }}
                {{ form.instagram(class="w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500") }}
                {% for error in form.instagram.errors %}
                    <span class="text-red-500 text-sm">{{ error }}</span>
                {% endfor %}
            </div>
            <div>
                {{ form.github.label(class="block font-semibold text-gray-700 mb-1") }}
                {{ form.github(class="w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500") }}
                {% for error in form.github.errors %}
                    <span class="text-red-500 text-sm">{{ error }}</span>
                {% endfor %}
            </div>
        </div>

        {{ form.submit(class="bg-green-600 text-white px-6 py-2 rounded-xl hover:bg-green-700 transition font-semibold") }}
    </form>

    <!-- Avatar Upload -->
    <div class="mt-8">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Update Profile Picture</h2>

        <!-- Current Avatar -->
        <div class="mb-4">
            <img src="{% if user.avatar_url_filename %}
                        {{ url_for('static', filename='uploads/avatars/' ~ user.avatar_url_filename) }}?v={{ user.updated_at.timestamp() if user.updated_at else 0 }}
                     {% else %}
                        {{ url_for('static', filename='uploads/avatars/default.png') }}
                     {% endif %}"
                 alt="{{ user.username }}"
                 class="w-32 h-32 rounded-full object-cover mb-3 border-4 border-green-500 shadow-md">
        </div>

        <form method="POST" action="{{ url_for('profile.upload_avatar') }}" enctype="multipart/form-data">
            {{ avatar_form.hidden_tag() }}

            <div class="mb-3">
                {{ avatar_form.avatar.label(class="block font-semibold text-gray-700 mb-1") }}
                {{ avatar_form.avatar(class="w-full") }}
                {% for error in avatar_form.avatar.errors %}
                    <span class="text-red-500 text-sm">{{ error }}</span>
                {% endfor %}
            </div>

            {{ avatar_form.submit(class="bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700 transition font-semibold") }}
        </form>
    </div>

</div>
{% endblock %}
